<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>LDPathWrapper.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Fedora LDPath service</a> &gt; <a href="../index.html" class="el_bundle">fcrepo-ldpath</a> &gt; <a href="index.source.html" class="el_package">org.fcrepo.camel.ldpath</a> &gt; <span class="el_source">LDPathWrapper.java</span></div><h1>LDPathWrapper.java</h1><pre class="source lang-java linenums">/*
 * Licensed to DuraSpace under one or more contributor license agreements.
 * See the NOTICE file distributed with this work for additional information
 * regarding copyright ownership.
 *
 * DuraSpace licenses this file to you under the Apache License,
 * Version 2.0 (the &quot;License&quot;); you may not use this file except in
 * compliance with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.fcrepo.camel.ldpath;

import static java.util.Collections.singletonList;

import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.Collection;
import java.util.List;
import java.util.Map;
import java.util.Set;

import com.github.jsonldjava.sesame.SesameJSONLDParserFactory;
import org.apache.marmotta.ldpath.LDPath;
import org.apache.marmotta.ldpath.api.functions.SelectorFunction;
import org.apache.marmotta.ldpath.backend.linkeddata.LDCacheBackend;
import org.apache.marmotta.ldpath.exception.LDPathParseException;
import org.openrdf.model.Value;
import org.openrdf.model.impl.URIImpl;
import org.openrdf.query.resultio.BooleanQueryResultParserRegistry;
import org.openrdf.query.resultio.TupleQueryResultParserRegistry;
import org.openrdf.query.resultio.sparqlxml.SPARQLBooleanXMLParserFactory;
import org.openrdf.query.resultio.sparqlxml.SPARQLResultsXMLParserFactory;
import org.openrdf.rio.RDFParserRegistry;
import org.openrdf.rio.n3.N3ParserFactory;
import org.openrdf.rio.ntriples.NTriplesParserFactory;
import org.openrdf.rio.rdfjson.RDFJSONParserFactory;
import org.openrdf.rio.rdfxml.RDFXMLParserFactory;
import org.openrdf.rio.trig.TriGParserFactory;
import org.openrdf.rio.turtle.TurtleParserFactory;
import org.semarglproject.sesame.rdf.rdfa.SesameRDFaParserFactory;

/**
 * A convenience factory for creating an LDPath object with an LDCacheBackend.
 * @author acoburn
 * @since Aug 5, 2016
 */
public class LDPathWrapper {

    private final LDPath&lt;Value&gt; ldpath;

    /**
     * Create an LDPathWrapper and register a set of selector functions.
     *
     * @param backend the linkeddata backend
     * @param functions selector functions
     */
    @SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
    public LDPathWrapper(final LDCacheBackend backend, final Set&lt;SelectorFunction&gt; functions) {
<span class="nc" id="L66">        this(backend);</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">        for (SelectorFunction&lt;Value&gt; function : functions) {</span>
<span class="nc" id="L68">            ldpath.registerFunction(function);</span>
<span class="nc" id="L69">        }</span>
<span class="nc" id="L70">    }</span>

    /**
     * Create an LDPathWrapper Object
     * @param backend the linkeddata backend
     */
<span class="fc" id="L76">    public LDPathWrapper(final LDCacheBackend backend) {</span>

        // Register the Sesame RDF Parsers manually
        // TODO: use the OSGi service registry as described in:
        // http://blog.osgi.org/2013/02/javautilserviceloader-in-osgi.html
<span class="fc" id="L81">        RDFParserRegistry.getInstance().add(new RDFXMLParserFactory());</span>
<span class="fc" id="L82">        RDFParserRegistry.getInstance().add(new NTriplesParserFactory());</span>
<span class="fc" id="L83">        RDFParserRegistry.getInstance().add(new TurtleParserFactory());</span>
<span class="fc" id="L84">        RDFParserRegistry.getInstance().add(new N3ParserFactory());</span>
<span class="fc" id="L85">        RDFParserRegistry.getInstance().add(new SesameJSONLDParserFactory());</span>
<span class="fc" id="L86">        RDFParserRegistry.getInstance().add(new RDFJSONParserFactory());</span>
<span class="fc" id="L87">        RDFParserRegistry.getInstance().add(new SesameRDFaParserFactory());</span>
<span class="fc" id="L88">        RDFParserRegistry.getInstance().add(new TriGParserFactory());</span>
<span class="fc" id="L89">        BooleanQueryResultParserRegistry.getInstance().add(new SPARQLBooleanXMLParserFactory());</span>
<span class="fc" id="L90">        TupleQueryResultParserRegistry.getInstance().add(new SPARQLResultsXMLParserFactory());</span>

<span class="fc" id="L92">        ldpath = new LDPath&lt;Value&gt;(backend);</span>
<span class="fc" id="L93">    }</span>

    /**
     * Execute an LDPath query
     * @param uri the URI to query
     * @param program the LDPath program
     * @return a result object wrapped in a List
     * @throws LDPathParseException if the LDPath program was malformed
     */
    public List&lt;Map&lt;String, Collection&lt;?&gt;&gt;&gt; programQuery(final String uri, final InputStream program)
            throws LDPathParseException {
<span class="fc" id="L104">        return singletonList(ldpath.programQuery(new URIImpl(uri), new InputStreamReader(program)));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>